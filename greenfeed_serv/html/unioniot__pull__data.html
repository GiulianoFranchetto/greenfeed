<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.6"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Greenfeed - EMSE server program: iot_pull_data Union Reference</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="custom.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Greenfeed - EMSE server program 1.0</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">iot_pull_data Union Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &quot;<a class="el" href="iot__pull__data_8h_source.html">includes/iot_pull_data.h</a>&quot;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a019f7d47cfe35a4e91ae5068647c1014"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unioniot__pull__data.html#a019f7d47cfe35a4e91ae5068647c1014">msg</a> [<a class="el" href="constants_8h.html#a786442238545011e2a0eb7ce468ad692">INCOMMING_MSG_SIZE</a>]</td></tr>
<tr class="separator:a019f7d47cfe35a4e91ae5068647c1014"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aedf31c3dc77c1995181f8ac4236ff0"><td class="memItemLeft" ><a class="anchor" id="a4aedf31c3dc77c1995181f8ac4236ff0"></a>
struct {</td></tr>
<tr class="memitem:a4723ed0bc6ed806bf66757d25e40641a"><td class="memItemLeft" >&#160;&#160;&#160;byte&#160;&#160;&#160;<a class="el" href="unioniot__pull__data.html#a4723ed0bc6ed806bf66757d25e40641a">protocol_version</a></td></tr>
<tr class="separator:a4723ed0bc6ed806bf66757d25e40641a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada15cc4b0b6fe37df4be93e5260089e3"><td class="memItemLeft" ><a class="anchor" id="ada15cc4b0b6fe37df4be93e5260089e3"></a>
&#160;&#160;&#160;byte&#160;&#160;&#160;<b>token</b> [2]</td></tr>
<tr class="separator:ada15cc4b0b6fe37df4be93e5260089e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3661902d618d08427f1ab8cca0411413"><td class="memItemLeft" ><a class="anchor" id="a3661902d618d08427f1ab8cca0411413"></a>
&#160;&#160;&#160;byte&#160;&#160;&#160;<b>pull_data_id</b></td></tr>
<tr class="separator:a3661902d618d08427f1ab8cca0411413"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7badc8040877155f12b7d17871dfe626"><td class="memItemLeft" ><a class="anchor" id="a7badc8040877155f12b7d17871dfe626"></a>
&#160;&#160;&#160;byte&#160;&#160;&#160;<b>MAC</b> [8]</td></tr>
<tr class="separator:a7badc8040877155f12b7d17871dfe626"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95fd1d801d35ecbda7a3a9b479d2d2f3"><td class="memItemLeft" ><a class="anchor" id="a95fd1d801d35ecbda7a3a9b479d2d2f3"></a>
&#160;&#160;&#160;char&#160;&#160;&#160;<b>json</b> [<a class="el" href="constants_8h.html#a786442238545011e2a0eb7ce468ad692">INCOMMING_MSG_SIZE</a>-1-2-1-8]</td></tr>
<tr class="separator:a95fd1d801d35ecbda7a3a9b479d2d2f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aedf31c3dc77c1995181f8ac4236ff0"><td class="memItemLeft" valign="top">};&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:a4aedf31c3dc77c1995181f8ac4236ff0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Here is a part of the official documentation. The structure <a class="el" href="unioniot__pull__data.html">iot_pull_data</a> is a C representation of the documentation </p>
<h3>5.2. PULL_DATA packet</h3>
<p>That packet type is used by the gateway to poll data from the server.</p>
<p>This data exchange is initialized by the gateway because it might be impossible for the server to send packets to the gateway if the gateway is behind a NAT.</p>
<p>When the gateway initialize the exchange, the network route towards the server will open and will allow for packets to flow both directions. The gateway must periodically send PULL_DATA packets to be sure the network route stays open for the server to be used at any time.</p>
<table class="doxtable">
<tr>
<th align="center">Bytes </th><th>Function  </th></tr>
<tr>
<td align="center">0 </td><td>protocol version = 1 </td></tr>
<tr>
<td align="center">1-2 </td><td>random token </td></tr>
<tr>
<td align="center">3 </td><td>PULL_DATA identifier 0x02 </td></tr>
<tr>
<td align="center">4-11 </td><td>Gateway unique identifier (MAC address) </td></tr>
</table>
<p>An union is different from a structure in how it manages memory. In a structure, the memory scheme is as follow : <br/>
 |_field A_|____________ field B__________| Padding |____Field C____| ... <br/>
 Each field starts when the field before stops (some padding may be added, by that's an other topic). An union typical scheme is as follow: <br/>
 |_field A_|<br/>
 |___________field B_________|<br/>
 |field C|<br/>
 All the fields start at the same adress. <br/>
 So, why an union? As the documentation says, the message received by the server is a 12 bytes, and each byte has its own usage. We have to "cut" the message in part to get each packet of bytes. We could have done it by using the substring function, but that's boring (need to manage memory allocation, calculate indexes ...). By using an union AND an internal structure, we can achieve the same thing by way more easily. We use an union to make the message and the internal structure to start at the same address. Then we use the structure memory scheme to create fields which have the perfect size to "cut" the message where it needs to be. Let's see the result : <br/>
 </p>
<div class="image">
<img src="iot_pull_data.png" alt="iot_pull_data.png"/>
</div>
<p>As we can see, the protocol_version field of the structure has the same content of the first byte of the message, and so does token ... </p>
</div><h2 class="groupheader">Field Documentation</h2>
<a class="anchor" id="a019f7d47cfe35a4e91ae5068647c1014"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char msg[<a class="el" href="constants_8h.html#a786442238545011e2a0eb7ce468ad692">INCOMMING_MSG_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the field in which the message sent by the IoT station will be </p>

</div>
</div>
<a class="anchor" id="a4723ed0bc6ed806bf66757d25e40641a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">byte protocol_version</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This is the structure which will cut the message. To have some explanations about the packed attribute, go see Mr LALEVEE </p>

</div>
</div>
<hr/>The documentation for this union was generated from the following file:<ul>
<li>includes/<a class="el" href="iot__pull__data_8h_source.html">iot_pull_data.h</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 30 2015 16:51:23 for Greenfeed - EMSE server program by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
